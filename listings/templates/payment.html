{% extends "base.html" %}

{% block content %}
<div class="min-h-[70vh] flex items-center justify-center">

  <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">

    <!-- Header -->
    <h2 class="text-2xl font-semibold mb-1">
      Confirm & Pay
    </h2>
    <p class="text-gray-500 mb-6">
      Review your booking details
    </p>

    <!-- Listing Info -->
    <div class="flex gap-4 mb-6">
      {% with listing.images.first as img %}
        {% if img %}
          <img src="{{ img.image.url }}"
               class="w-24 h-20 rounded-lg object-cover">
        {% else %}
          <div class="w-24 h-20 bg-gray-200 rounded-lg"></div>
        {% endif %}
      {% endwith %}

      <div>
        <h3 class="font-semibold">{{ listing.title }}</h3>
        <p class="text-sm text-gray-500">{{ listing.location }}</p>
      </div>
    </div>

    <!-- Booking Summary -->
    <div class="border rounded-lg p-4 mb-6 space-y-2 text-sm">
      <div class="flex justify-between">
        <span>Check-in</span>
        <span>{{ booking.check_in }}</span>
      </div>
      <div class="flex justify-between">
        <span>Check-out</span>
        <span>{{ booking.check_out }}</span>
      </div>
      <div class="flex justify-between font-semibold border-t pt-2">
        <span>Total</span>
        <span>₹{{ booking.total_price }}</span>
      </div>
    </div>

    <!-- Pay Button -->
    <button id="rzp-button"
            class="w-full bg-red-500 hover:bg-red-600
                   text-white py-3 rounded-lg font-semibold">
      Pay ₹{{ booking.total_price }}
    </button>

    <p class="text-center text-xs text-gray-400 mt-4">
      Secure payment powered by Razorpay
    </p>
  </div>

</div>

<!-- Razorpay Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
var options = {
    "key": "{{ razorpay_key }}",
    "amount": "{{ order.amount }}",
    "currency": "INR",
    "name": "Airbnb Clone",
    "description": "{{ listing.title }}",
    "order_id": "{{ order.id }}",
    "handler": function (response){
        window.location.href =
          `/bookings/verify/?payment_id=${response.razorpay_payment_id}
          &order_id=${response.razorpay_order_id}
          &signature=${response.razorpay_signature}`;
    }
};

var rzp1 = new Razorpay(options);
document.getElementById('rzp-button').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>
{% endblock %}
